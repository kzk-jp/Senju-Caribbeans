<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8" />
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  Â  <title>ãƒ•ãƒƒãƒˆã‚µãƒ«ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹ãƒ„ãƒªãƒ¼ï¼ˆD3.jsç‰ˆï¼‰</title>
Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  font-family: "Helvetica Neue", sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }

Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  font-size: 1.4rem;
Â  Â  Â  Â  Â  Â  background: #2563eb; /* blue-700 */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* iframe ã‚¹ã‚¿ã‚¤ãƒ«ã¯ä¸è¦ã«ãªã£ãŸãŸã‚å‰Šé™¤ */

Â  Â  Â  Â  #chart-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  Â  Â  overflow-y: hidden;
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  Â  Â  padding: 1rem 0.5rem;
Â  Â  Â  Â  Â  Â  box-sizing: border-box; /* Include padding in width */
Â  Â  Â  Â  }

Â  Â  Â  Â  svg {
Â  Â  Â  Â  Â  Â  display: block; /* Remove extra space below svg */
Â  Â  Â  Â  Â  Â  margin: 0 auto; /* Center SVG if wider than container */
Â  Â  Â  Â  }

Â  Â  Â  Â  .node-card {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  border: 1px solid #d1d5db; /* gray-300 */
Â  Â  Â  Â  Â  Â  border-radius: 12px; /* rounded-xl */
Â  Â  Â  Â  Â  Â  padding: 8px; /* Increased padding slightly */
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  Â  Â  width: 120px; /* Increased width slightly */
Â  Â  Â  Â  Â  Â  box-sizing: border-box; /* Include padding and border in width */
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .node-card a {
Â  Â  Â  Â  Â  Â  Â text-decoration: none; /* Remove underline from links */
Â  Â  Â  Â  Â  Â  Â color: inherit; /* Inherit text color */
Â  Â  Â  Â  Â  Â  Â display: flex; /* Use flexbox for link content */
Â  Â  Â  Â  Â  Â  Â flex-direction: column; /* Stack content vertically within link */
Â  Â  Â  Â  Â  Â  Â align-items: center; /* Center content horizontally within link */
Â  Â  Â  Â  Â  Â  Â width: 100%; /* Make link fill the card width */
Â  Â  Â  Â  }


Â  Â  Â  Â  .node-image {
Â  Â  Â  Â  Â  Â  width: 50px;
Â  Â  Â  Â  Â  Â  height: 50px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  Â  Â  margin-bottom: 6px; /* Increased space below image */
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  Â .node-placeholder {
Â  Â  Â  Â  Â  Â  Â width: 50px;
Â  Â  Â  Â  Â  Â  Â height: 50px;
Â  Â  Â  Â  Â  Â  Â border-radius: 50%;
Â  Â  Â  Â  Â  Â  Â background-color: #d1d5db; /* bg-gray-300 */
Â  Â  Â  Â  Â  Â  Â display: flex;
Â  Â  Â  Â  Â  Â  Â align-items: center;
Â  Â  Â  Â  Â  Â  Â justify-content: center;
Â  Â  Â  Â  Â  Â  Â color: #4b5563; /* text-gray-600 */
Â  Â  Â  Â  Â  Â  Â font-weight: bold; /* font-bold */
Â  Â  Â  Â  Â  Â  Â font-size: 1rem; /* Increased font size */
Â  Â  Â  Â  Â  Â  Â margin-bottom: 6px; /* Increased space below placeholder */
Â  Â  Â  Â  Â }


Â  Â  Â  Â  .node-name {
Â  Â  Â  Â  Â  Â  font-size: 11px; /* Increased font size slightly */
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: 600; /* Increased font weight */
Â  Â  Â  Â  Â  Â  line-height: 1.3; /* Adjusted line height */
Â  Â  Â  Â  Â  Â  white-space: normal; /* Allow text to wrap */
Â  Â  Â  Â  Â  Â  word-break: break-word; /* Break long words */
Â  Â  Â  Â  Â  Â  max-width: 100%; /* Ensure name fits within card */
Â  Â  Â  Â  }

Â  Â  Â  Â  Â .node-introducer, .node-reason {
Â  Â  Â  Â  Â  Â  Â font-size: 9px; /* Smaller font for details */
Â  Â  Â  Â  Â  Â  Â color: #555;
Â  Â  Â  Â  Â  Â  Â text-align: center;
Â  Â  Â  Â  Â  Â  Â line-height: 1.2;
Â  Â  Â  Â  Â  Â  Â white-space: normal;
Â  Â  Â  Â  Â  Â  Â word-break: break-word;
Â  Â  Â  Â  Â  Â  Â max-width: 100%;
Â  Â  Â  Â  Â  Â  Â margin-top: 2px; /* Space above introducer/reason */
Â  Â  Â  Â  Â }


Â  Â  Â  Â  .link {
Â  Â  Â  Â  Â  Â  fill: none;
Â  Â  Â  Â  Â  Â  stroke: #94a3b8; /* slate-400 */
Â  Â  Â  Â  Â  Â  stroke-width: 1.5px; /* Increased line thickness */
Â  Â  Â  Â  }
Â  Â  </style>
Â  Â  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
Â  Â  <h1>ãƒ•ãƒƒãƒˆã‚µãƒ«ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹ãƒ„ãƒªãƒ¼ï¼ˆD3.jsç‰ˆï¼‰</h1>
Â  Â  <div id="chart-container">
Â  Â  Â  Â  <svg id="tree-svg"></svg>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // ã“ã“ã‚’GitHubã®Rawtherapee URLã«å¤‰æ›´ã—ã¦ãã ã•ã„
Â  Â  Â  Â  const JSON_FILE_PATH = 'tree_data.json'; // Replace with your actual GitHub Raw URL

Â  Â  Â  Â  window.addEventListener("DOMContentLoaded", () => {
Â  Â  Â  Â  Â  Â  fetch(JSON_FILE_PATH)
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .then(jsonData => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!Array.isArray(jsonData)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("chart-container").innerHTML = "<p>ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Group data by introduction_reason for separate trees
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const groupedData = d3.group(jsonData, d => d.introduction_reason || "ãã®ä»–");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const svg = d3.select("#tree-svg");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chartContainer = d3.select("#chart-container");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const margin = {top: 40, right: 20, bottom: 40, left: 20}; // Adjusted margins
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nodeWidth = 120; // Matches .node-card width
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nodeHeight = 80; // Approximate height of .node-card content
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const verticalSpacing = 50; // Space between parent and child levels
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const horizontalSpacing = 20; // Minimum space between sibling nodes

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let currentYOffset = margin.top;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let maxSvgWidth = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Create a main group to hold all group subtrees
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mainG = svg.append("g");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  groupedData.forEach((groupData, reason) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Find the root node(s) for this group (introducerPageId is null within this group's data)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Note: D3 hierarchy typically expects a single root. If a group has multiple
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // members with introducerPageId === null, they will be treated as separate roots
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // within this group's processing, but we'll append them sequentially.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const rootNodesData = groupData.filter(d => d.introducerPageId === null);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â rootNodesData.forEach(rootData => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Build the hierarchy for this root and its descendants
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const root = d3.hierarchy(rootData, d => jsonData.filter(item => item.introducerPageId === d.id));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Define the tree layout
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const treeLayout = d3.tree()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .nodeSize([nodeHeight + verticalSpacing, nodeWidth + horizontalSpacing]); // [vertical, horizontal] spacing

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Compute the layout
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â treeLayout(root);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Calculate the extent of the subtree for positioning
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â let x0 = Infinity, x1 = -Infinity;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â root.each(d => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (d.x < x0) x0 = d.x;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (d.x > x1) x1 = d.x;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Calculate the width of the subtree
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const subtreeWidth = x1 - x0 + nodeWidth + horizontalSpacing;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (subtreeWidth > maxSvgWidth) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â maxSvgWidth = subtreeWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Calculate the horizontal offset to center the subtree (initially)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // This centering might be relative to the maxSvgWidth or the container width
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Let's center relative to the potential max width for consistent horizontal alignment
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const offsetX = (maxSvgWidth / 2) - ((x1 + x0) / 2);


Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Create a group for the current subtree
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const subtreeG = mainG.append("g")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("transform", `translate(${margin.left + offsetX}, ${currentYOffset})`); // Apply margin and calculated offset

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Draw links
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â subtreeG.append("g")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("fill", "none")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("stroke-linejoin", "round")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("stroke-width", 1.5) /* Increased line thickness */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .selectAll("path")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .data(root.links())
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .join("path")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "link")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("d", d3.linkVertical()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .x(d => d.x)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .y(d => d.y)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â );

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Draw nodes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const node = subtreeG.append("g")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .selectAll("g")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .data(root.descendants())
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .join("g")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("transform", d => `translate(${d.x},${d.y})`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Append foreignObject for HTML content
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const nodeCard = node.append("foreignObject")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("x", -(nodeWidth / 2)) // Center the foreignObject horizontally
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("y", -(nodeHeight / 2)) // Center the foreignObject vertically (approx)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("width", nodeWidth)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("height", nodeHeight)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .append("xhtml:div")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "node-card");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Add link wrapper if URL exists
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const linkWrapper = nodeCard.append("a")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("href", d => d.data.page_url || "#") // Use 'page_url' field for link
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("target", "_blank"); // Open in new tab

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Add image or placeholder
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â linkWrapper.each(function(d) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const container = d3.select(this);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (d.data.image) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.append("img")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "node-image")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("src", d.data.image)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("alt", "photo");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.append("div")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "node-placeholder")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .text(d.data.name ? d.data.name.charAt(0) : '?');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });


Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Add text content (name, introducer, reason)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const textContent = linkWrapper.append("div"); // Put text inside the link
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â textContent.append("div")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "node-name")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .text(d => d.data.name);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â textContent.each(function(d) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const container = d3.select(this);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (d.data.introducer_name) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.append("div")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .attr("class", "node-introducer")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .text(`ç´¹ä»‹è€…: ${d.data.introducer_name}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Reason is used for grouping title, might not be needed on every card
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â /*
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (d.data.introduction_reason) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.append("div")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .attr("class", "node-reason")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .text(`(${d.data.introduction_reason})`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });


Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Add space for the next subtree
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â currentYOffset += root.height * (nodeHeight + verticalSpacing) + margin.bottom + verticalSpacing; // Calculate height based on subtree depth

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }); // End rootNodesData.forEach
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }); // End groupedData.forEach

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Adjust SVG width and height based on content
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  svg.attr("width", maxSvgWidth + margin.left + margin.right);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  svg.attr("height", currentYOffset + margin.bottom);


Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ğŸŒŸ ä¸­å¤®ã«è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const containerElement = document.getElementById("chart-container");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use a slight delay to ensure rendering is complete before scrolling
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â containerElement.scrollLeft = (svg.attr("width") - containerElement.clientWidth) / 2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }, 100);


Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching JSON data:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById("chart-container").innerHTML = "<p>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚GitHubã®Rawtherapee URLãŒæ­£ã—ã„ã‹ã€ã¾ãŸã¯CORSã®å•é¡ŒãŒãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>";
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  Â // Optional: Redraw on window resize (more complex with D3 layout)
Â  Â  Â  Â  Â // For simplicity, we'll skip full redraw on resize for this example.
Â  Â  Â  Â  Â // A robust solution would recalculate layout and redraw SVG on resize.

Â  Â  </script>
</body>
</html>
